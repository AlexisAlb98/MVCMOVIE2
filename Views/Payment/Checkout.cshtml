@*
    Archivo: Views/MercadoPago/Checkout.cshtml
*@
@{
    ViewBag.Title = "Checkout";
}
@using System.Globalization

@{
    ViewData["Title"] = "Checkout";
}

<h2>Checkout</h2>

<!-- SDK MercadoPago.js -->
<script src="https://sdk.mercadopago.com/js/v2"></script>

<!-- Contenedor para el botón de pago -->
<div id="wallet_container"></div>

<script>
    const mp = new MercadoPago('@ViewBag.PublicKey');
    const bricksBuilder = mp.bricks();

    bricksBuilder.create("wallet", "wallet_container", {
        initialization: {
            preferenceId: "@ViewBag.PreferenceId",
        },
        customization: {
            texts: {
                valueProp: 'smart_option',
            },
        },
    });
</script>


<script>
    const form = document.getElementById('paymentForm');
    form.addEventListener('submit', async function (event) {
        event.preventDefault();

        const card = {
            cardNumber: document.getElementById('cardNumber').value,
            cardExpirationMonth: document.getElementById('cardExpirationMonth').value,
            cardExpirationYear: document.getElementById('cardExpirationYear').value,
            securityCode: document.getElementById('securityCode').value
        };

        // Obtener el token de la tarjeta de crédito
        const tokenResponse = await mp.createToken(card);
        if (tokenResponse.status === 200) {
            // Asignar el token al campo oculto
            document.getElementById('token').value = tokenResponse.body.id;

            // Enviar el formulario al servidor
            form.submit();
        } else {
            alert('Hubo un error al obtener el token de la tarjeta de crédito.');
        }
    });
</script>